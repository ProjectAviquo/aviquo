{% extends 'components/box_plus.html' %}
{% block title %}Forum{% endblock title %}
{% block head %}
<link rel="stylesheet" href="/static/lists/opportunities.css" />
{% endblock head %}

{%block the_lifted%}

{%endblock%}

{% block after_content %}
<div class="lifted-box" id="posts">
    <h2>Opportunities</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>URL</th>
                <th>Tags</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for opportunity in opportunities %}
            <tr>
                <td>{{ opportunity.id }}</td>
                <td>{{ opportunity.name }}</td>
                <td>{{ opportunity.description }}</td>
                <td><a href="{{ opportunity.URL }}" target="_blank">{{ opportunity.URL }}</a></td>
                <td>
                    <ul>
                        {% for tag in opportunity.tags.all %}
                        <li>{{ tag.name }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>
                    {% if opportunity in user.followed_opps.all %}
                    <button class="follow-button" data-opportunity-id="{{ opportunity.id }}">
                        Unfollow
                    </button>
                    {% else %}
                    <button class="follow-button" data-opportunity-id="{{ opportunity.id }}">
                        Follow
                    </button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script>
   $(".follow-button").click(function () {
        const button = $(this);
        const opportunityId = button.data("opportunity-id");
        const action = button.text().toLowerCase(); // Follow or Unfollow

        // Send an AJAX request to your Django view
        $.ajax({
            type: "POST",
            url: "/follow-opportunity/",  // Replace with the actual URL
            data: {
                opportunity_id: opportunityId,
                action: action,
                csrfmiddlewaretoken: '{{ csrf_token }}',  // Include the CSRF token
            },
            success: function (response) {
                if (response === "followed") {
                    button.text("Unfollow");
                } else {
                    button.text("Follow");
                }
            },
        });
    });
</script>
{% endblock after_content %}